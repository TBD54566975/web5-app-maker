<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Web5 App maker</title>

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css" />
    <link rel="icon" href="https://www.tbd.website/images/tbd-fav-icon-main.png" />
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&amp;display=swap" rel="stylesheet">

    <style>
      body {
        display: flex;
        flex-direction: column;
        height: 100vh;
        margin: 0;
      }

      .main-wrapper {
        flex: 1;
        display: flex;
        overflow: hidden;
      }

      .preview-wrapper {
        flex: 1;
        padding: 0px;
        box-sizing: border-box;
        overflow: auto;
      }

      .preview {
        width: 100%;
        height: 100%;
        border: none;
      }

      .output-wrapper {
        flex: 1;
        padding: 20px;
        box-sizing: border-box;
        overflow: auto;
        display: none;
      }

      .output {
        width: 100%;
        height: 100%;
        border: none;
        resize: none;
        font-family: monospace;
        font-size: 16px;
      }

      .editor-wrapper {
        height: 200px;
        border-top: 1px solid #ccc;
        padding: 20px;
        box-sizing: border-box;
        overflow: auto;
      }

      .editor {
        width: 100%;
        height: 100%;
        border: none;
        resize: none;
        font-family: monospace;
        font-size: 16px;
      }

      .docs {
        font-family: monospace;
        font-size: 16px;
      }

      .footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: #f8f9fa;
        color: #6c757d;
        padding: 10px 20px;
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        border-top: 1px solid #dee2e6;
      }

      .footer a {
        color: #6c757d;
        text-decoration: none;
        margin: 0 10px;
      }

      .footer a:hover {
        text-decoration: underline;
      }

      .activity-container {
        width: 100%;
        height: 30px;
        background-color: #f3f3f3;
        position: relative;
        visibility: hidden;
      }

      .activity-bar {
        height: 100%;
        width: 20%;
        position: absolute;
        background: linear-gradient(90deg, #3498db, #9b59b6);
        animation: activity-animation 2s linear infinite;
      }

      @keyframes activity-animation {
        0% {
          left: 0;
        }
        50% {
          left: 80%;
        }
        100% {
          left: 0;
        }
      }
    </style>
  </head>
  <body>
    <a
      class="github-fork-ribbon"
      href="https://github.com/TBD54566975/web5-omg"
      data-ribbon="Fork me on GitHub"
      title="Fork me on GitHub">
      Fork me on GitHub
    </a>
    <div class="main-wrapper">
      <div class="preview-wrapper">
        <iframe class="preview"></iframe>
      </div>
      <div class="output-wrapper">
        <textarea class="output"></textarea>
      </div>
    </div>
    <div class="editor-wrapper">
      <textarea
        class="editor"
        placeholder="Add your instructions of how to build or modify app here and press return. ChatGPT will then attempt to build an app that meets your needs.

Example prompts:
  'build an app that shows a list of todo items'
  'Write an app that stores my name, birthday and favourite season of the year (make it a dropdown)'

Once your app is available, you can modify the source or ask it to make changes.

"></textarea>
    </div>

    <div class="activity-container">
      <div class="activity-bar"></div>
    </div>

    <div class="editor-wrapper">
      <!-- checkbox to show/hide output -->
      <div>
        <input type="checkbox" id="toggle-output" />
        <label class="docs" for="toggle-output">Show/hide generated source code</label>
      </div>
    </div>

    <div class="footer">
      <div class="docs">
        Try some pre made apps:
        <a
          class="docs"
          href="https://codesandbox.io/s/github/TBD54566975/web5-omg/tree/main/generated-examples/todo"
          target="_blank">
          üï∏Ô∏è‚ë§ Todo App üëà
        </a>
        <a
          class="docs"
          href="https://codesandbox.io/s/github/TBD54566975/web5-omg/tree/main/generated-examples/seasons"
          target="_blank">
          üï∏Ô∏è‚ë§ Seasons App üëà
        </a>
      </div>

      <div class="docs">
        <a href="/component-builder" target="_blank">üëâ Show web‚ë§ component builder</a>
      </div>
    </div>

    <script>
      const editor = document.querySelector('.editor');
      const preview = document.querySelector('.preview');
      const output = document.querySelector('.output');
      const outputWrapper = document.querySelector('.output-wrapper');
      const toggleOutputBtn = document.getElementById('toggle-output');

      toggleOutputBtn.addEventListener('change', event => {
        if (event.target.checked) {
          outputWrapper.style.display = 'block';
        } else {
          outputWrapper.style.display = 'none';
        }
      });

      // add an event listener on editor for when the user presses enter
      editor.addEventListener('keydown', e => {
        if (e.key === 'Enter') {
          // prevent the default behavior of the enter key
          e.preventDefault();

          // show that the browser is busy
          editor.style.cursor = 'wait';
          document.querySelector('.activity-container').style.visibility = 'visible';

          fetch('/prompt', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              prompt: editor.value,
              context_html: output.value,
            }),
          })
            .then(response => response.text())
            .then(text => {
              output.value = text;
              preview.contentDocument.open();
              preview.contentDocument.write(output.value);
              preview.contentDocument.close();
              // make cursor not busy
              editor.style.cursor = 'auto';
              document.querySelector('.activity-container').style.visibility = 'hidden';
            });
        }
      });

      output.addEventListener('input', () => {
        preview.contentDocument.open();
        preview.contentDocument.write(output.value);
        preview.contentDocument.close();
      });

      // load the initial value from /app
      fetch('/app')
        .then(response => response.text())
        .then(text => {
          output.value = text;
          preview.contentDocument.open();
          preview.contentDocument.write(output.value);
          preview.contentDocument.close();
        });
    </script>
  </body>
</html>
